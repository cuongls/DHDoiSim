@model DHDoiSim.Models.Sim_Phieu
@using DHDoiSim.Common;
@{User user = new User();}

@{
    ViewBag.Title = "Create";
}
<br />
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">
    <h2>Xuất phiếu Đổi Sim</h2>
    <hr />
    <h4 style="color:green">Số ĐT: @ViewBag.SoDT_ Phòng: @ViewBag.TenPhong_</h4>

    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <div class="form-group">

    </div>

    @*ThaiHN thêm*@
    <div class="form-group">
        @Html.LabelFor(model => model.ID_Sim_KH, "ID_Sim_KH", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.ID_Sim_KH, new { htmlAttributes = new { @class = "form-control", @Value = @ViewBag.ID_Sim_KH_, @readonly = "readonly" } })
            @Html.ValidationMessageFor(model => model.ID_Sim_KH, "", new { @class = "text-danger" })
        </div>
    </div>
    @*Hết thêm*@

    <div class="form-group">
        @Html.LabelFor(model => model.ID_MucUuTien, "MucUuTien", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownList("ID_MucUuTien", null, htmlAttributes: new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.ID_MucUuTien, "", new { @class = "text-danger" })
        </div>
    </div>
    
    <div class="form-group">
        @Html.LabelFor(model => model.ID_Phong, "ID_Phong", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownList("ID_Phong", null, htmlAttributes: new { @class = "form-control", @id= "ID_Phong", onchange = "OnGradeChanged_Phong()" })
            @Html.ValidationMessageFor(model => model.ID_Phong, "", new { @class = "text-danger" })
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(model => model.UserNhanPhieu, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-4">
            @Html.EditorFor(model => model.UserNhanPhieu, new { htmlAttributes = new { @class = "form-control", @id = "UserNhanPhieu", @Value = ViewBag.UserNhanPhieu } })
            @Html.ValidationMessageFor(model => model.UserNhanPhieu, "", new { @class = "text-danger" })
        </div>
        <div class="col-md-3">
            <font color="#FF0000">
                @*@Html.Label("Phường xã:")*@
                <select id="UserNhanPhieu_" class="form-control" onchange="OnGradeChanged_UserNhanPhieu(this.value);">
                    <option value="" selected>Thay đổi người nhận phiếu</option>
                    @{
                        foreach (var item in ViewBag.list_user)
                        {
                            <option value="@item.UserName">@item.Name - @item.UserName</option>
                        }
                    }
                </select>
            </font>
        </div>


    </div>
    @*<div class="form-group">
            @Html.LabelFor(model => model.ID_To, "ID_To", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("ID_To", null, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.ID_To, "", new { @class = "text-danger" })
            </div>
        </div>*@

    <div class="form-group">
        @Html.LabelFor(model => model.TimeXP, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.TimeXP, new { htmlAttributes = new { @class = "form-control", @Value = System.DateTime.Now, @readonly = "readonly" } })
            @Html.ValidationMessageFor(model => model.TimeXP, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.UserXP, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.UserXP, new { htmlAttributes = new { @class = "form-control", @Value = user.USERNAME, @readonly = "readonly" } })
            @Html.ValidationMessageFor(model => model.UserXP, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.NoiDungXP, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.NoiDungXP, new { htmlAttributes = new { @class = "form-control" } })
            @Html.ValidationMessageFor(model => model.NoiDungXP, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.GhiChu, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.GhiChu, new { htmlAttributes = new { @class = "form-control" } })
            @Html.ValidationMessageFor(model => model.GhiChu, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Xuất phiếu" class="btn btn-default" />
        </div>
    </div>
</div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script>
    function OnGradeChanged_Phong() {
        $("#UserNhanPhieu_").empty();
        var value = document.getElementById("ID_Phong").value;
        $.ajax({
            type: "GET",
            url: "/NhanKhoaPhieu/Get_User",
            data: { phong: value },
            contentType: "application/json; charset=utf-8",
            dataType: "html",
            success: function (response) {
                var a = response.replace("\"", "").replace("\"", "").split(","), i;
                for (i = 0; i < a.length; i++) {
                    if (a[i].length > 0)
                        $('#UserNhanPhieu_').append('<option value="' + a[i].split("-")[0] + '"> ' + a[i] + ' </option>');
                }
                //alert(response.responseText);
                //$('#dialog').show('open');
            },
            failure: function (response) {
                //alert(response.responseText);
            },
            error: function (response) {
                //alert(response.responseText);
            }
        });
    }
    function OnGradeChanged_UserNhanPhieu(value) {
        $("#UserNhanPhieu").val(value);
       
    }
   
</script>